<!-- templates/header.html – Chỉ chứa header, không có thẻ html/head/body -->
<header
  id="main-header"
  class="fixed inset-x-0 top-0 z-50 transition-transform duration-300 -translate-y-full"
>
  <div class="bg-white/90 backdrop-blur-md shadow-lg border-b border-gray-100">
    <div class="container mx-auto px-4 h-16 flex items-center justify-between">
      <!-- Logo -->
      <a href="/dashboard" class="flex items-center gap-3 group">
        <div
          class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform"
        >
          <span class="text-white font-bold text-lg">BK</span>
        </div>
        <div>
          <h1 class="font-bold text-blue-900 text-xl leading-tight">
            HCMUT Tutor
          </h1>
          <p class="text-xs text-blue-600 font-medium opacity-80">System</p>
        </div>
      </a>

      <!-- Navigation Menu -->
      <nav class="flex items-center gap-6">
        <!-- Menu Sinh viên -->
        {% if user and user.role == 'student' %}
        <div class="hidden lg:flex items-center gap-1">
          <a
            href="/dashboard"
            class="flex items-center gap-2.5 px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"
          >
            <i data-lucide="layout-dashboard" class="w-4.5 h-4.5"></i>
            Dashboard
          </a>
          <a
            href="/find-tutor"
            class="flex items-center gap-2.5 px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"
          >
            <i data-lucide="search" class="w-4.5 h-4.5"></i>
            Tìm Tutor
          </a>
          <a
            href="/my_tutors"
            class="relative flex items-center gap-2.5 px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"
          >
            <i data-lucide="heart-handshake" class="w-4.5 h-4.5"></i>
            Tutor của tôi
            <span
              id="tutorPendingBadge"
              class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center shadow-sm hidden"
            >
              0
            </span>
          </a>
          <a
            href="/student/schedule"
            class="flex items-center gap-2.5 px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"
          >
            <i data-lucide="calendar" class="w-4.5 h-4.5"></i>
            Lịch học
          </a>
        </div>
        {% endif %}

        <!-- Menu Tutor -->
        {% if user and user.role == 'tutor' %}
        <div class="hidden lg:flex items-center gap-1">
          <a
            href="/tutor/dashboard"
            class="flex items-center gap-2.5 px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"
          >
            <i data-lucide="layout-dashboard" class="w-4.5 h-4.5"></i>
            Dashboard
          </a>
          <a
            href="/schedule"
            class="flex items-center gap-2.5 px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"
          >
            <i data-lucide="calendar-check" class="w-4.5 h-4.5"></i>
            Lịch rảnh
          </a>
        </div>
        {% endif %}

        <!-- User Info + Logout -->
        <div class="flex items-center gap-3 ml-4 pl-4 border-l border-gray-200">
          <div class="flex items-center gap-3">
            <div
              class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm shadow-lg ring-2 ring-white"
            >
              {{ user.ho_ten[0] if user and user.ho_ten else 'U' }}
            </div>
            <div class="hidden md:block">
              <p class="text-sm font-semibold text-gray-900">
                {{ user.ho_ten if user else 'Khách' }}
              </p>
              <p class="text-xs text-gray-500">
                {{ user.role|capitalize if user else 'Chưa đăng nhập' }}
              </p>
            </div>
          </div>

          <button
            onclick="handleLogout()"
            class="flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition"
          >
            <i data-lucide="log-out" class="w-4.5 h-4.5"></i>
            <span class="hidden md:inline">Đăng xuất</span>
          </button>
        </div>
      </nav>
    </div>
  </div>
</header>

<!-- Spacer để nội dung không bị header che -->
<div class="h-16"></div>

<!-- Script xử lý header + badge -->
<script>
  // Header hiện khi scroll
  const header = document.getElementById("main-header");
  function toggleHeader() {
    if (window.scrollY > 60) {
      header.classList.remove("-translate-y-full");
    } else {
      header.classList.add("-translate-y-full");
    }
  }
  window.addEventListener("scroll", toggleHeader);
  toggleHeader();

  // Logout
  async function handleLogout() {
    try {
      await fetch("/api/logout", { method: "POST" });
    } catch (e) {}
    window.location.href = "/";
  }

  // Cập nhật badge số yêu cầu đang chờ (chỉ sinh viên)
  async function updatePendingBadge() {
    const badge = document.getElementById("tutorPendingBadge");
    if (!badge) return;

    try {
      const res = await fetch("/api/my_tutor_requests");
      if (!res.ok) return;
      const data = await res.json();
      const pending = data.filter((r) => r.status === "pending").length;

      badge.textContent = pending;
      badge.classList.toggle("hidden", pending === 0);
    } catch (err) {
      console.log("Badge update failed:", err);
    }
  }

  // Chạy khi load + mỗi 30 giây
  document.addEventListener("DOMContentLoaded", () => {
    lucide.createIcons();
    updatePendingBadge();
    setInterval(updatePendingBadge, 30000);
  });
</script>
